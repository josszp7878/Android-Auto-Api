# Android 远程控制系统

一个基于 WebSocket 的 Android 设备远程控制系统，支持多设备管理和命令执行。

## 系统架构

### 服务端 (server/)
- Flask + Flask-SocketIO 提供 WebSocket 服务
- Vue.js + Bootstrap 实现 Web 控制台
- SQLite 数据库保存设备信息

### 客户端 (client/)
- Python SocketIO 客户端
- 支持命令行测试和 Android 集成模式
- 基于 Chaquopy 实现 Python-Java 交互

## 核心功能

### 1. 设备管理
- 设备自动注册和状态监控
- 多设备并行管理
- 设备状态持久化存储

### 2. 命令系统
- 支持命令行测试和 APP 集成两种模式
- 内置多种设备控制命令：
  * 点击 <x> <y>: 模拟点击
  * 屏幕内容: 获取屏幕文本
  * 返回/主屏幕: 导航控制
  * 应用管理: 打开/关闭/安装/卸载
  * 截屏: 屏幕截图

### 3. Web 控制台
- 实时设备列表显示
- 命令输入和执行
- 命令历史记录
- 执行结果实时反馈

## 最近更新

### 1. 命令系统重构
- 添加条件编译支持
- 实现命令注册机制
- 支持命令行测试模式

### 2. 设备管理优化
- 改进设备状态同步
- 优化设备连接机制
- 添加设备信息持久化

### 3. 界面优化
- 添加命令控制台
- 优化设备选择机制
- 改进命令响应显示

## 待开发功能
1. 设备截图预览
2. 设备状态定时检查
3. 命令执行历史记录
4. 批量命令执行

## 更新日志

### 2023年10月15日

- 修复了命令历史显示顺序的问题，现在最近的命令显示在最下面。
- 优化了设备状态的同步逻辑，避免了不必要的数据库提交。
- **新增**：支持服务器端命令。现在可以通过 `@` 开头的命令直接在服务器端执行。

### 2023年12月27日

- **合并功能**：文件服务器功能已合并到主服务器中，现在可以通过单一入口启动所有服务。
- **连接测试**：手机终端测试连接服务器成功，确保了客户端与服务器的稳定通信。

### 2023年12月28日

- **新增**：在 `ScriptEngine` 中添加 `uninit` 方法，用于在应用退出时调用 `main.py` 的 `End` 方法进行清理。
- **更新**：在 `MainActivity` 的 `onDestroy` 方法中调用 `ScriptEngine` 的 `uninit` 方法。

### 2023年12月29日

- **重构**: 将日志相关功能从 Tools 类移至 Device 类,实现更合理的职责划分
- **优化**: 统一了日志输出机制,支持Android和命令行两种环境
- **新增**: 服务器命令支持忽略大小写的模糊匹配
- **新增**: 添加 @echo 命令用于测试日志输出

### 2023年12月30日

- **重构**: 整合文件服务器到主服务器,简化系统架构
- **优化**: 移除命令行控制台,统一使用 Web 界面进行操作
- **改进**: 所有服务集成到单一进程,提高系统稳定性

### 2023年12月31日

- **重构**: 重新设计日志系统
  * 统一客户端和服务器的日志接口(Device.i/w/e)
  * 支持日志实时显示和历史记录
  * 日志按时间倒序显示，最新的显示在底部
  * 日志分级显示(INFO/WARN/ERROR)，使用不同颜色区分
- **优化**: 改进设备类的单例实现
  * 修复设备ID初始化问题
  * 优化参数传递机制
  * 添加设备状态管理
- **改进**: Web界面交互优化
  * 添加日志自动滚动功能
  * 支持历史日志分页加载
  * 优化日志显示样式

## 使用说明

- 运行 `server.bat` 或 `python MyServer.py` 启动服务器
- 通过 Web 界面(http://localhost:5000)进行所有操作
- 使用 `@` 开头的命令执行服务器操作
- 所有日志和操作历史都在 Web 界面显示

## 贡献指南

- 提交代码时，请确保所有更改都经过测试。
- 使用 `master` 分支进行提交。