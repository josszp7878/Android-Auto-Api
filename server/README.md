# Android 远程控制系统

一个基于 WebSocket 的 Android 设备远程控制系统，支持多设备管理和命令执行。

## 系统架构

### 服务端 (server/)
- Flask + Flask-SocketIO 提供 WebSocket 服务
- Vue.js + Bootstrap 实现 Web 控制台
- SQLite 数据库保存设备信息

### 客户端 (client/)
- Python SocketIO 客户端
- 支持命令行测试和 Android 集成模式
- 基于 Chaquopy 实现 Python-Java 交互

## 核心功能

### 1. 设备管理
- 设备自动注册和状态监控
- 多设备并行管理
- 设备状态持久化存储

### 2. 命令系统
- 支持命令行测试和 APP 集成两种模式
- 内置多种设备控制命令：
  * 点击 <x> <y>: 模拟点击
  * 屏幕内容: 获取屏幕文本
  * 返回/主屏幕: 导航控制
  * 应用管理: 打开/关闭/安装/卸载
  * 截屏: 屏幕截图

### 3. Web 控制台
- 实时设备列表显示
- 命令输入和执行
- 命令历史记录
- 执行结果实时反馈

## 最近更新

### 1. 命令系统重构
- 添加条件编译支持
- 实现命令注册机制
- 支持命令行测试模式

### 2. 设备管理优化
- 改进设备状态同步
- 优化设备连接机制
- 添加设备信息持久化

### 3. 界面优化
- 添加命令控制台
- 优化设备选择机制
- 改进命令响应显示

## 待开发功能
1. 设备截图预览
2. 设备状态定时检查
3. 命令执行历史记录
4. 批量命令执行

## 更新日志

### 2023年10月15日

- 修复了命令历史显示顺序的问题，现在最近的命令显示在最下面。
- 优化了设备状态的同步逻辑，避免了不必要的数据库提交。
- **新增**：支持服务器端命令。现在可以通过 `@` 开头的命令直接在服务器端执行。

### 2023年12月27日

- **合并功能**：文件服务器功能已合并到主服务器中，现在可以通过单一入口启动所有服务。
- **连接测试**：手机终端测试连接服务器成功，确保了客户端与服务器的稳定通信。

### 2023年12月28日

- **新增**：在 `ScriptEngine` 中添加 `uninit` 方法，用于在应用退出时调用 `main.py` 的 `End` 方法进行清理。
- **更新**：在 `MainActivity` 的 `onDestroy` 方法中调用 `ScriptEngine` 的 `uninit` 方法。

## 使用说明

- 确保在 `server/app/device_manager.py` 中直接设置设备状态属性。
- 在 `server/app/static/js/dashboard.js` 中，命令历史按时间排序，确保最近的在最下面。
- 服务器端命令示例：使用 `@status` 查看服务器状态。
- 确保在 `server/server/run.py` 中正确配置文件服务器和主服务器的启动。
- 通过运行 `run.py` 启动所有服务。

## 贡献指南

- 提交代码时，请确保所有更改都经过测试。
- 使用 `master` 分支进行提交。