# Android Auto API

## 更新日志

### 2023-10-13
- 新增Page类click方法，用于PC平台模拟Android端点击效果
  - 调用tools.click的同时，在PC平台额外执行指定操作
  - 支持三种操作格式：
    - < : 页面跳转到上一页
    - >pageName: 跳转到pageName指定的页面
    - +d: 收获d金币，如果d不是数字，则收获this.d金币
  - 提高了PC平台测试的真实性和便捷性
  - 简化了跨平台开发和调试流程

### 2023-10-12
- 增强页面timeout属性的功能
  - timeout配置值不再只是数字，而是支持字符串格式："等待时间长度&执行的操作"
  - 新增页面的_timeout和_timeoutOp属性，分别存储超时时间和超时操作
  - 在timeout的getter中实现lazy初始化，自动解析timeout字符串
  - 将timeout处理从App._update移动到Page.update中
  - 超时时执行指定的操作，如果没有指定操作则执行退出逻辑
  - 提高了页面超时处理的灵活性和可控性

### 2023-10-11
- 优化页面引用机制和安全性
  - 将exitPages改为私有变量_exitPages，通过属性访问器提供安全访问
  - 完善getInst方法实现，支持正确创建页面实例和配置复制
  - 优化参数处理，区分配置项和数据项
  - 简化App.getPage中的公共页面处理逻辑，直接返回公共页面
  - 修复了引用页面不存在时的错误日志类型

### 2023-10-10
- 优化页面配置和检测机制
  - 移除commonPages配置，改为使用更灵活的页面引用机制
  - 新增页面引用功能，支持在exit配置中使用#开头的引用页面
  - 引用格式：#引用页面名{参数JSON}，参数部分可选
  - 添加_Page_类的exitPages属性，存储当前页面可跳转的目标页面
  - 优化detectPage方法，只检测当前页面的exitPages中的页面，提高性能
  - 页面引用支持参数传递，可以根据不同场景定制页面行为
  - 引用页面只在公共页面中查找，确保引用的一致性

### 2023-10-09
- 增加应用公共页面配置功能
  - 在root配置中添加commonPages配置项，用于定义要加入到应用的公共页面
  - 修改_loadConfig方法，支持自动加载commonPages中定义的公共页面
  - 利用现有getPage方法的includeCommon参数加载公共页面
  - 公共页面会从TOP应用中复制并添加到当前应用
  - 提高了页面复用性，减少重复配置工作

### 2023-10-08
- 优化_doEvent方法实现
  - 移除了不再需要的子页面事件（P-页面名格式）处理逻辑
  - 简化了用户事件检查，确保app.userEvents始终存在
  - 重构了条件检查流程，提高了代码可读性
  - 统一了execute变量的初始化和设置逻辑
  - 为延时和无条件执行添加了明确的execute=True设置

### 2023-10-07
- 进一步优化用户事件处理机制
  - 将用户事件逻辑移入_doEvent方法，统一事件处理流程
  - 简化Page.update方法，不再单独检查用户事件
  - 减少了代码冗余，提高了事件处理效率
  - 优化了_doEvent方法的流程，使其处理逻辑更清晰

### 2023-10-06
- 优化了事件处理和用户事件机制
  - 重构了事件处理流程，移除了重复的检查逻辑
  - 将userEvents从页面属性改为应用实例变量，使其成为字符串列表
  - 添加了App.addUserEvent和App.clearUserEvents方法，用于管理用户事件
  - 在App._update中添加自动清空用户事件的逻辑，防止事件被重复触发
  - 简化了Page.update方法，直接调用_doEvent处理事件逻辑
  - 提高了用户事件处理的效率和可靠性
  - 减少了冗余代码，提升了代码可维护性

### 2023-09-02
- 重构了页面自动执行逻辑设计和优化
  - 添加了App._update方法检测当前页面并调用页面更新函数
  - 添加了全局App.update循环方法实现自动检测应用和页面
  - 实现了Page.update方法处理事件检测、页面跳转和用户事件
  - 将页面跳转处理从Page.update移至App._update
  - 改进了App.goPage方法，使其只设置目标页面
  - 实现了路径跳转，每次更新循环只跳转一步
  - 简化了路径缓存，直接存储当前目标路径
  - 优化了路径判断逻辑，检测当前页面是否在预定路径中
  - 在事件匹配过程中同步检查用户事件
  - 用户事件可以直接触发匹配的KEY事件
  - 移除了子页面(children)相关的代码
  - 删除了_startChild和_stopAllChildren方法

### 2023-09-01
- 优化了页面更新机制
  - 移除了Page.update中的循环逻辑，简化为单次执行
  - 适应App驱动的更新模式，提高执行效率
  - 修复了超时计算逻辑，使用页面创建时间而非更新开始时间
  - 简化了代码结构，提高了可维护性
  - 减少了内存和CPU资源消耗

### 2023-08-30
- 改进了用户事件处理逻辑
  - 在事件匹配过程中同步检查用户事件，提高响应效率
  - 用户事件现在可以直接触发匹配的KEY事件，无需额外处理
  - 精简了事件处理代码，减少冗余检查
  - 更明确的事件处理日志，便于调试
  - 提高了用户交互反馈的及时性和准确性

### 2023-08-25
- 进一步简化页面跳转逻辑
  - 将路径缓存从键值对改为直接存储当前目标路径
  - 移除不必要的缓存查找和路径重计算
  - 优化了路径判断逻辑，清晰检测当前页面是否在预定路径中
  - 减少了冗余代码，提高了执行效率
  - 更明确的错误处理，当页面不在路径上时直接报错

### 2023-08-20
- 优化了页面跳转性能
  - 添加路径缓存机制，避免重复计算页面间路径
  - 简化了goPage函数逻辑，专注于设置目标页面和路径缓存
  - 在App._update中利用缓存路径进行页面跳转
  - 增加缓存失效处理，当路径跳转失败时自动清除缓存
  - 大幅提高了复杂页面导航的性能和响应速度

### 2023-08-15
- 优化了页面跳转逻辑
  - 将页面跳转处理从Page.update移至App._update
  - 改进了App.goPage方法，使其只设置目标页面而不直接执行跳转
  - 在App._update中实现路径跳转，每次更新循环只跳转一步
  - 增强了页面间跳转的稳定性和效率，支持复杂路径自动导航
  - 优化了错误处理和日志记录，更易于调试和监控

### 2023-08-10
- 新增页面自动执行循环逻辑
  - 添加应用级_update方法，负责检测当前页面并调用页面更新函数
  - 新增全局update循环方法，实现自动检测当前应用和页面
  - 添加页面update方法，实现三大功能：
    - 检测事件是否满足条件KEY，使用tools.check检查并执行ACTION
    - 通过应用的_targetPage属性处理页面跳转逻辑
    - 检测用户事件，通过event.items()处理用户交互
  - 修改App.goPage方法，使用_targetPage属性设置跳转目标
  - 提高了应用自动化执行的灵活性和稳定性

### 2023-07-26
- 增强matchText函数功能
  - 支持&（与）和|（或）逻辑操作符，实现复杂条件匹配
  - 添加空括号()继承功能，可以继承前一个条件的区域范围
  - 示例："推荐(x300,500)&新剧()&VIP抢先|排行榜"
  - 完善逻辑表达式解析和评估算法
  - 提高了屏幕元素检测的灵活性和精确性

### 2023-07-25
- 增加了Page页面的父子关系支持
  - 添加了parent成员变量，用于存储父页面引用
  - 添加了setParent方法，用于设置父子页面关系并自动建立父页面退出到子页面的链接
  - 修改了getInst方法，支持在创建页面时设置父页面
  - 修改了_begin方法，在执行页面前确保与父页面的关系已正确设置

### 2023-12-10
- 改进了CRun模块的页面重入判断逻辑
- 现在批处理任务会根据页面的运行状态来判断是否可以重新进入，而不是简单地比较当前页面是否为目标页面
- 在Page类中添加了_running状态标志，用于跟踪页面是否正在运行
- 页面的begin方法会将_running设为True，end方法和_end方法会在页面结束时将_running设为False

### 之前的更新
<!-- 此处保留之前的更新记录 -->
